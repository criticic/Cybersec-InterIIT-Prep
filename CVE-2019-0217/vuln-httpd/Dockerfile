FROM httpd:2.4.38-alpine

# Copy the custom Apache config file
COPY httpd.conf /usr/local/apache2/conf/httpd.conf

# Install necessary packages
RUN apk add apache2-utils

# Create directories for CGI scripts and digest authentication
RUN mkdir -p /usr/local/apache2/htdocs/protected /usr/local/apache2/htdocs/cgi-bin

# Create test CGI scripts
COPY mycgi.cgi /usr/local/apache2/htdocs/cgi-bin/mycgi.cgi
RUN chmod +x /usr/local/apache2/htdocs/cgi-bin/mycgi.cgi

# Copy the digest password file
COPY digest_passwd /usr/local/apache2/conf/digest_passwd

# Expose port 80
EXPOSE 80

# Start Apache in foreground
CMD ["httpd-foreground"]